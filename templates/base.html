{% load notifications_tags %}
{% load i18n %}

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
	<head>
		<title>
			nity
		</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
	 <script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>	
	<script src="/static/bootstrap/js/bootstrap.js"></script>
	<script src="/static/shadowbox/shadowbox.js"></script>
	<link href="/static/main/main.css" rel="stylesheet" type="text/css"/>
	<link href="/static/shadowbox/shadowbox.css" rel="stylesheet" type="text/css"/>
    	<link href="/static/bootstrap/css/bootstrap.css" rel="stylesheet" type="text/css"/>
	<link rel="shortcut icon" type="image/x-icon" href="/static/main/img/favicon_unity.ico">
	<link rel="stylesheet" type="text/css" href="/static/main/ajax-search.css" />
	<link rel="stylesheet" type="text/css" href="/static/main/datepicker.css" />
	<script src="/static/main/ajax-search.js" type="text/javascript"></script>
	<script src="/static/main/bootstrap-datepicker.js" type="text/javascript"></script>
	<style>
		#overlay {
    background-color: rgba(0, 0, 0, 0.6);
    z-index: 999;
    position: absolute;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    display: none;
    text-align: center;
}
	</style>
	<script type="text/javascript">
		
			Shadowbox.init({
    skipSetup: true,
    overlayColor : "#000",
});

$(document).ready(function () {
    // Code adapted from http://djangosnippets.org/snippets/1389/  
    function updateElementIndex(el, prefix, ndx) {
        var id_regex = new RegExp('(' + prefix + '-\\d+-)');
        var replacement = prefix + '-' + ndx + '-';
        if ($(el).attr("for")) $(el).attr("for", $(el).attr("for").replace(id_regex,
        replacement));
        if (el.id) el.id = el.id.replace(id_regex, replacement);
        if (el.name) el.name = el.name.replace(id_regex, replacement);
    }

    function deleteForm(btn, prefix) {
        var formCount = parseInt($('#id_' + prefix + '-TOTAL_FORMS').val());
        if (formCount > 1) {
            // Delete the item/form
            $(btn).parents('.item').remove();
            var forms = $('.item'); // Get all the forms  
            // Update the total number of forms (1 less than before)
            $('#id_' + prefix + '-TOTAL_FORMS').val(forms.length);
            var i = 0;
            // Go through the forms and set their indices, names and IDs
            for (formCount = forms.length; i < formCount; i++) {
                $(forms.get(i)).children().children().each(function () {
                    if ($(this).attr('type') == 'text') updateElementIndex(this, prefix, i);
                });
            }
		}

        else {
            alert("You have to enter at least one todo item!");
        }
        return false;
    }

    function addForm(btn, prefix) {
        var formCount = parseInt($('#id_' + prefix + '-TOTAL_FORMS').val());
        // You can only submit a maximum of 10 todo items 
        if (formCount < 10) {
            // Clone a form (without event handlers) from the first form
            var row = $(".item:first").clone(false).get(0);
            // Insert it after the last form
            $(row).removeAttr('id').hide().insertAfter(".item:last").slideDown(300);

            // Remove the bits we don't want in the new row/form
            // e.g. error messages
            $(".errorlist", row).remove();
            $(row).children().removeClass("error");
			
			// Relabel/rename all the relevant bits
			  $(row).find('input,select,textarea').each(function() {
				updateElementIndex(this, prefix, formCount);

				  $(this).val('');
			  });

            // Add an event handler for the delete item/form link 
            $(row).find(".delete").click(function () {
                return deleteForm(this, prefix);
            });
            
            // Add an event handler for onchange dropodownlist
            $(row).find("#id_form-"+formCount+"-data_type").on('change',function() {
			insert_values_to_forms(this.id.match(/\d+/g),this.value);
			});
			
			$(row).find( "#id_form-"+formCount+"-domain option" ).prop('disabled',false);
			//$( "#id_form-"+id+"-domain option").prop('disabled',false);
			
            // Update the total form count
            $("#id_" + prefix + "-TOTAL_FORMS").val(formCount + 1);
        } // End if
        else {
            alert("Sorry, you can only enter a maximum of ten items.");
        }
        return false;
    }
    
    
    // Register the click event handlers
    $("#add").click(function () {
        return addForm(this, "form");
    });

    $(".delete").click(function () {
        return deleteForm(this, "form");
    });
    
    
	for ( var i =0; i < 20; i++ )
	{

		if ($("#id_form-"+ i+"-data_type").length > 0) {
		  
		   $("#id_form-"+i+"-data_type").on('change', function() {
			  insert_values_to_forms(this.id.match(/\d+/g),this.value); // send the number value from id_form-0-input (0) to find which form selected user
			});
			
			// check if form has values and make them read only
			
			var myInput = document.getElementById('id_form-'+i+'-name');
			if (myInput && myInput.value) {
			 document.getElementById('id_form-'+i+'-name').readOnly=true;
			 document.getElementById('id_form-'+i+'-description').readOnly=true;
			 $( "#id_form-"+i+"-domain option:not(:selected)" ).prop('disabled',true);
			}
			
		}
			

	}
	
	

	
});




function insert_values_to_forms(id,value)
{
	// make false readonly and dropdown disable
	document.getElementById('id_form-'+id+'-name').readOnly=false;
	$( "#id_form-"+id+"-domain option").prop('disabled',false);
	document.getElementById('id_form-'+id+'-description').readOnly=false;
	
	var flag = 0;
	var content = '';
	
	if ( value == "Profile_Input" )
	{ 
		flag = 1;
		var data = {{profile_data|safe}};
		var sample = String(data[i]);
		var content = "<center> <br> <br> Επιλέξτε ποιο πεδίο του profile επιθυμείτε από την παρακάτω λίστα: <br> <br>";
		for ( var i=0; i< data.length;i++)
		{
			var sample = String(data[i]);
			if ( value == "Application_Input" || value == "Output"  )
				sample = sample.split(",")[1];
			content += "<h4 onclick='selected_values("+i+","+id+","+flag+")'> "+sample+"</h4> "
		}
		content += "<br><h4 onclick='selected_values("+i+","+id+",0)'> Αν δεν βρήκατε το δεδομένο που ψάχνετε πατήστε εδώ και εισάγετε τιμές στα πεδία</h4><br> <br></center>";
		
		Shadowbox.open({
        content:    content,
        player:     "html",
        title:      "Επιλέξτε δεδομένο",
        height:     600,
		width:      800
		});

	}else if ( value == "Application_Input"  || value == "Output"  )
	{
		var idle_input = {{idle_input|safe}};
		var output =  {{output|safe}};
		
		// content for outputs
		flag = 2;
		var content = "<center> <br> <h3> Επιλέξτε ποιο παραγόμενο δεδομένο σας ταιριάζει: </h3> <br>";
		for ( var i=0; i< output.length;i++)
			content += "<h4 onclick='selected_values("+i+","+id+","+flag+")'> "+output[i].name+"</h4> "
		
		
		// content for idle inputs
		flag = 3;
		 content += " <br> <h3> Επιλέξτε ποια idle δεδομένα σας ταιριάζουν: </h3><br>";

		for ( var i=0; i< idle_input.length;i++)
			content += "<h4 onclick='selected_values("+i+","+id+","+flag+")'> "+idle_input[i].name+"</h4> "
		
		
		/*
		// content for inputs
		flag = 4;
		content += " <br>Επιλέξτε ποια input δεδομένα σας ταιριάζουν: <br> <br>";

		for ( var i=0; i< input.length;i++)
			content += "<h4 onclick='selected_values("+i+","+id+","+flag+")'> "+input[i].name+"</h4> "
		*/
		
		content += "<br><h4 onclick='selected_values("+i+","+id+",0)'> Αν δεν βρήκατε το δεδομένο που ψάχνετε πατήστε εδώ και εισάγετε τιμές στα πεδία</h4><br> <br></center>";
		
		
		Shadowbox.open({
        content:    content,
        player:     "html",
        title:      "Επιλέξτε δεδομένο",
        height:     600,
		width:      800
		});
		
	}else if ( value == "User_Input")
	{
		selected_values(-1,id,flag);
	}


		
	 
}// end of function insert_values_to_forms
	
	


function selected_values(i,id,flag)
{
	console.log('in select values '+id+' '+i+' '+flag);
	if ( flag == 1) // Profile
	{ 
		var profile_data = {{profile_data|safe}};
		document.getElementById('id_form-'+id+'-name').value = profile_data[i];
		document.getElementById('id_form-'+id+'-name').readOnly=true;

		document.getElementById('id_form-'+id+'-domain').selectedIndex=4;
		$( "#id_form-"+id+"-domain option:not(:selected)" ).prop('disabled',true); // disable all except selected value
		
		document.getElementById('id_form-'+id+'-description').value = "Το δεδομένο "+profile_data[i]+" από το προφίλ του χρήστη";
		document.getElementById('id_form-'+id+'-description').readOnly=true;
		Shadowbox.close();

	}else if ( flag == 2) // Output
	{
		var profile_data = {{output|safe}};
		document.getElementById('id_form-'+id+'-name').value = String(profile_data[i].name);
		document.getElementById('id_form-'+id+'-name').readOnly=true;
		
		document.getElementById('id_form-'+id+'-domain').selectedIndex= String(profile_data[i].domain);
		$( "#id_form-"+id+"-domain option:not(:selected)" ).prop('disabled',true); // disable all except selected value
		
		document.getElementById('id_form-'+id+'-description').value = String(profile_data[i].description);
		document.getElementById('id_form-'+id+'-description').readOnly=true;
		Shadowbox.close();
		
	}
	else if ( flag == 3) // Indle Input
	{
		var profile_data = {{idle_input|safe}};
		document.getElementById('id_form-'+id+'-name').value = String(profile_data[i].name);
		document.getElementById('id_form-'+id+'-name').readOnly=true;
		
		document.getElementById('id_form-'+id+'-domain').selectedIndex= String(profile_data[i].domain);
		$( "#id_form-"+id+"-domain option:not(:selected)" ).prop('disabled',true); // disable all except selected value
		
		document.getElementById('id_form-'+id+'-description').value = String(profile_data[i].description);
		document.getElementById('id_form-'+id+'-description').readOnly=true;
		Shadowbox.close();
		
	}
	/*
	else if ( flag == 4) //  Input
	{
		var profile_data = {{input|safe}};
		document.getElementById('id_form-'+id+'-name').value = String(profile_data[i].name);
		document.getElementById('id_form-'+id+'-name').readOnly=true;
		
		document.getElementById('id_form-'+id+'-domain').selectedIndex= String(profile_data[i].domain);
		$( "#id_form-"+id+"-domain option:not(:selected)" ).prop('disabled',true); // disable all except selected value
		
		document.getElementById('id_form-'+id+'-description').value = String(profile_data[i].description);
		document.getElementById('id_form-'+id+'-description').readOnly=true;
		Shadowbox.close();
		
	} */
	else if ( flag == 0) // User
	{
		document.getElementById('id_form-'+id+'-name').value = '';
		document.getElementById('id_form-'+id+'-name').readOnly=false;
		
		document.getElementById('id_form-'+id+'-domain').selectedIndex='';
		$( "#id_form-"+id+"-domain" ).prop('disabled',false);
		
		document.getElementById('id_form-'+id+'-description').value = "";
		document.getElementById('id_form-'+id+'-description').readOnly=false;
		Shadowbox.close();
	}
	

}

</script>
	
	</head>
	<body class="yui-skin-sam" id="top">
		
	{% block top %}
		{% if user.is_authenticated %}
		
			<div class="navbar navbar-default navbar-fixed-top">
				
				
				
				{% if user.profile.role|stringformat:"s" == "Developer" %} <!--# check if user is developer -->
					<ul class="nav navbar-nav" id="main-nav">
						<a class="navbar-brand" href="#"><img width="50" src="/static/main/img/unity.gif" alt="Unity Logo"/></a>
						<li><a href="/">Αρχική</a></li>
						<li><a href="/user/profile/{{user.username}}">Προφίλ</a></li>
						<li><a href="/user/search/">Χρήστες</a></li>
						<li><a href="/groups/">Ομάδες</a></li>  
						<li><a href="/apps/">Εφαρμογές</a> </li> 
						{% if user.is_superuser %}
							<li><a href="/admin" target="blank">Διαχείριση</a> </li> 
						{% endif %}
					</ul>
				{%else%}						
					<ul class="nav navbar-nav" id="main-nav">
						<a class="navbar-brand" href="#"><img width="50" src="/static/main/img/unity.gif" alt="Unity Logo"/></a>
						<li><a href="/">Αρχική</a></li>
						<li><a href="/user/profile/{{user.username}}">Προφίλ</a></li>
						<li><a href="/user/search">Χρήστες</a></li>  
						<li><a href="/groups/">Ομάδες</a></li>
						<li><a href="/apps">Εφαρμογές</a> </li> 
					</ul>
				{% endif %}
				
				
				
				<div id="right-nav-opts">
					<ul class="nav navbar-nav navbar-right">
						<div id="logged-in-panel">{% notifications_unread as unread_count %}
							<div class="btn-group">
							<button type="button" class="btn btn-info dropdown-toggle" data-toggle="dropdown">
								<span class="glyphicon glyphicon-bullhorn">&nbsp;<span id="notifications-count">{{ unread_count }}<span></span>
							</button>
							<div class="dropdown-menu">
								<iframe id="notifications-tab" scrolling="yes" frameborder="0" src="/notifications/unread"></iframe>	
							</div>
						</div>
						&nbsp;<a class="profile-picture-prev" data-toggle="tooltip" title="{{user.profile.displayName}}" href="/user/profile/{{user.username}}"><img src="{{user.profile.thumbnailURL}}" class="img-rounded" title="{{user.profile.displayName}}" /></a>&nbsp;&nbsp;<a href="/user/logout/" class="btn btn-primary">Αποσύνδεση</a></div>
					</ul>
				</div>
			</div><br>
				
		{% else %}
		<div id="not_authenticated"></div>
		{% endif %}
		
	{% endblock %}
		
	<div id="bd">
		{% block content %}
		{% endblock %}
	</div>
	
	<div id="ft">
		{% block footer %}
		{% endblock %}
		
			
	
	</div>	
	
	<div id="overlay">
	<div id="overlay_content"></div>
	</div>
<!--
	<div id="test"> 
		sdvojiiinmnil
		
		sdvs
		\sd
		vsdvs
		
		vsd
		</div>
		
		</div>
		<script>
		$(function () {
			$("#overlay").show();
		});
		</script>
-->
		
	</body>
</html>
